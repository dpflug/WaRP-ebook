image: asciidoctor/docker-asciidoctor

stages:
  - asciidoctor
  - test
  - calibre

html:
  stage: asciidoctor
  script:
    - asciidoctor WaRP.adoc
  artifacts:
    paths:
      - WaRP.html

pdf:
  stage: asciidoctor
  script:
    - asciidoctor-pdf WaRP.adoc
  artifacts:
    paths:
      - WaRP.pdf

# Direct epub generation disabled until I adhere to the rules in the asciidoctor-epub3 docs:
# https://github.com/asciidoctor/asciidoctor-epub3#structuring-your-manuscript
#epub:
#  stage: asciidoctor
#  script:
#    - asciidoctor-epub3 WaRP.adoc
#  artifacts:
#    paths:
#      - WaRP.epub

# I haven't seen a way to validate non-epub results
#test_epub:
#  stage: test
#  script:
#    - asciidoctor-epub3 -D output -a ebook-validate WaRP.adoc

ebook:
  stage: calibre
  before_script:
    - apt-get update -qq ; apt-get install -y -qq calibre
  script:
    - ebook-convert WaRP.html WaRP.epub
    - ebook-convert WaRP.html WaRP.mobi
  artifacts:
    paths:
      - WaRP.epub
      - WaRP.mobi
  dependencies:
    - html
